const app = getApp();
const cache = require("../../utils/cache.js");
const urlMember = app.baseUrl + "service-member/";
import axios from '../../utils/axios.js';
import _http from '../../utils/request.js';
let dataList = []
Page({
  data: {
    path: false,
    type: "DESC",
    data: [],
    successList: [],
    onTheWayList: [],
    pagesize: 0,
    information: [],
    show:false,
    money: "9.8",
    height:"",
    width:""
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function(options) {
    this.setData({
      height: (wx.getSystemInfoSync().windowHeight-173)+"px",
      width: wx.getSystemInfoSync().windowWidth+"px"
    })
    console.log(this.data.height)
    this.list()
    this.money()
  },
  money(){
    _http.get({
      url: `${app.baseUrl}service-user/public/member/doors`
    }).then(res=>{
      console.log(res)
      this.setData({
        money:res.data
      })
    })
  },
  cut(e) {
    let type = e.currentTarget.dataset.type
    dataList = []

    if (type == "success") {
      this.setData({
        path: false,
        pagesize: 0
      })
      this.paging(this.data.successList, this.data.pagesize)
    } else if (type == "path") {
      this.setData({
        path: true,
        pagesize: 0
      })
      this.paging(this.data.onTheWayList, this.data.pagesize)
    }
  },
  skip(){
      wx.navigateTo({
        url: '/my_member/wallet/wallet',
      })
  },
  reminder(){
    this.setData({
      show:true
    })
  },
  close(){
    this.setData({
      show: false
    })
  },
  list() {
    // ${cache.get("userId","null")}
    axios.get({
      url: `${urlMember}public/get/my/home/invite/grade?userId=${cache.get("userId", "null")}&sort=${this.data.type}`,
    }).then(res => {
      this.setData({
        data: res.data.respData,
        successList: res.data.respData.successList,
        onTheWayList: res.data.respData.onTheWayList,
        successSize: res.data.respData.successSize,
        onTheWaySize: res.data.respData.onTheWaySize,
      })
      if (this.data.path) {
        this.paging(this.data.onTheWayList, this.data.pagesize)
      } else {
        this.paging(this.data.successList, this.data.pagesize)
      }
    })
  },
  rank() {
    dataList = []
    if (this.data.type == "DESC") {
      this.setData({
        type: "ASC",
        pagesize: 0
      })
    } else if (this.data.type == "ASC") {
      this.setData({
        type: "DESC",
        pagesize: 0
      })
    }
    this.list()
  },
  scroll(e) {
    if (this.data.path) { //在路上
      let data = this.data.onTheWayList
      this.paging(data, this.data.pagesize)
      if (this.data.pagesize > this.data.onTheWaySize) {
        wx.showLoading({
          title: '到底了..',
        })
        setTimeout(() => {
          wx.hideLoading()
        }, 500)
      } else {
        wx.showLoading({
          title: '加载中..',
        })
        setTimeout(() => {
          wx.hideLoading()
        }, 500)
      }
    } else { //成功
      let data = this.data.successList
      this.paging(data, this.data.pagesize)
      if (this.data.pagesize > this.data.successSize) {
        wx.showLoading({
          title: '到底了..',
        })
        setTimeout(() => {
          wx.hideLoading()
        }, 500)
      } else {
        wx.showLoading({
          title: '加载中..',
        })
        setTimeout(() => {
          wx.hideLoading()
        }, 500)
      }
    }

  },
  paging(data, i) {
    let list = data.slice(i, i + 5)
    i = i + 5
    list.map(e => dataList.push(e))
    this.setData({
      pagesize: i,
      information: dataList
    })
  },
  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function() {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function() {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {
    dataList=[]
  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {
    dataList=[]
  },





  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function() {

  }
})